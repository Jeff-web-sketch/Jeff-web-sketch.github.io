<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pickle Type</title>
<style>
    body {
        background-color: #0f1f0f;
        color: #d9ffd9;
        font-family: monospace;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        padding-top: 50px;
        user-select: none;
    }
    #countdown {
        font-size: 3rem;
        margin-bottom: 20px;
    }
    #prompt {
        font-size: 1.8rem;
        max-width: 900px;
        margin-bottom: 30px;
        line-height: 2.5rem;
        white-space: pre-wrap;
    }
    .correct { color: #00ff00; }
    #stats { margin-top: 20px; font-size: 1.2rem; }
    #track {
        width: 900px;
        height: 50px;
        background: #334433;
        border-radius: 25px;
        margin-top: 30px;
        position: relative;
        overflow: hidden;
        border: 2px solid #55aa55;
    }
    #car {
        width: 50px;
        height: 50px;
        background-color: #55aa55;
        border-radius: 25px;
        position: absolute;
        left: 0;
        top: 0;
        transition: left 0.05s linear;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: #fff;
    }
    #resetBtn {
        margin-top: 30px;
        padding: 10px 20px;
        font-size: 1rem;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        background-color: #55aa55;
        color: white;
    }
    #endScreen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.9);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: #d9ffd9;
        font-size: 2rem;
        display: none;
    }
</style>
</head>
<body>

<h1>Pickle Type</h1>
<div id="countdown"></div>
<div id="prompt"></div>
<div id="stats">
    WPM: <span id="wpm">0</span> | Accuracy: <span id="accuracy">100</span>%
</div>
<div id="track">
    <div id="car">ü•í</div>
</div>
<button id="resetBtn">Reset</button>

<div id="endScreen">
    <div id="endMessage"></div>
    <div id="endStats"></div>
    <button id="endResetBtn">Play Again</button>
</div>

<script>
const prompts = [
    "Pickles are crunchy, green, and delicious, and they make sandwiches much more exciting to eat than plain bread.",
    "A dill pickle can be sweet, sour, or spicy, but they all bring a burst of flavor to burgers and snacks.",
    "Sometimes people forget that pickles are actually cucumbers that have been soaked in brine or vinegar for a long period.",
    "Adding pickles to your salad or burger gives a satisfying crunch that enhances every bite and makes meals more fun.",
    "Pickle Type is a fun typing game where you race your pickle across the track while practicing typing skills with long sentences."
];

let currentPrompt = "";
let correctIndex = 0;
let totalTyped = 0;
let correctTyped = 0;
let startTime = null;
let wpmInterval = null;

const countdownDiv = document.getElementById('countdown');
const promptDiv = document.getElementById('prompt');
const wpmSpan = document.getElementById('wpm');
const accuracySpan = document.getElementById('accuracy');
const car = document.getElementById('car');
const track = document.getElementById('track');
const resetBtn = document.getElementById('resetBtn');

const endScreen = document.getElementById('endScreen');
const endMessage = document.getElementById('endMessage');
const endStats = document.getElementById('endStats');
const endResetBtn = document.getElementById('endResetBtn');

function newPrompt() {
    const randomIndex = Math.floor(Math.random() * prompts.length);
    currentPrompt = prompts[randomIndex];
    correctIndex = 0;
    totalTyped = 0;
    correctTyped = 0;
    startTime = null;
    renderPrompt();
    wpmSpan.textContent = 0;
    accuracySpan.textContent = 100;
    car.style.left = "0px";
    countdownDiv.textContent = "";
    endScreen.style.display = "none";

    if (wpmInterval) clearInterval(wpmInterval);

    startCountdown();
}

function renderPrompt() {
    let html = "";
    for (let i = 0; i < currentPrompt.length; i++) {
        if (i < correctIndex) html += `<span class="correct">${currentPrompt[i]}</span>`;
        else html += `<span>${currentPrompt[i]}</span>`;
    }
    promptDiv.innerHTML = html;
}

function startCountdown() {
    let count = 3;
    countdownDiv.textContent = count;
    const interval = setInterval(() => {
        count--;
        if (count > 0) countdownDiv.textContent = count;
        else {
            countdownDiv.textContent = "Go!";
            clearInterval(interval);
            setTimeout(() => countdownDiv.textContent = "", 1000);
            document.addEventListener('keydown', handleTyping);
            startWPMTimer();
        }
    }, 1000);
}

// continuously update WPM
function startWPMTimer() {
    wpmInterval = setInterval(() => {
        if (!startTime) return;
        const elapsedMinutes = (new Date() - startTime) / 60000;
        const wpm = elapsedMinutes > 0 ? Math.round((correctTyped / 5) / elapsedMinutes) : 0;
        wpmSpan.textContent = wpm;
    }, 100);
}

function handleTyping(e) {
    if (!startTime) startTime = new Date();

    const char = e.key;
    if (char.length > 1) return; // ignore Shift, etc.

    totalTyped++;

    if (char === currentPrompt[correctIndex]) {
        correctTyped++;
        correctIndex++;
        renderPrompt();
        updateCar();
    }

    // accuracy = correct keystrokes / total keystrokes
    const accuracy = totalTyped === 0 ? 100 : Math.round((correctTyped / totalTyped) * 100);
    accuracySpan.textContent = accuracy;

    if (correctIndex >= currentPrompt.length) {
        document.removeEventListener('keydown', handleTyping);
        clearInterval(wpmInterval);
        showEndScreen();
    }
}

function updateCar() {
    const percent = correctIndex / currentPrompt.length;
    const trackWidth = track.offsetWidth - car.offsetWidth;
    car.style.left = (percent * trackWidth) + "px";
}

function showEndScreen() {
    const elapsedMinutes = (new Date() - startTime) / 60000;
    const finalWPM = elapsedMinutes > 0 ? Math.round((correctTyped / 5) / elapsedMinutes) : 0;
    const finalAccuracy = totalTyped === 0 ? 100 : Math.round((correctTyped / totalTyped) * 100);

    endMessage.textContent = "üèÅ You Finished the Race! üèÅ";
    endStats.textContent = `WPM: ${finalWPM} | Accuracy: ${finalAccuracy}%`;
    endScreen.style.display = "flex";
}

resetBtn.addEventListener('click', newPrompt);
endResetBtn.addEventListener('click', newPrompt);

// Start first race
newPrompt();
</script>

</body>
</html>
